<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Instalar Acesso</title>

  <link rel="manifest" href="../manifest.json" />
  <meta name="theme-color" content="#0f1115" />

  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui;background:#0f1115;color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:100%;max-width:440px;background:#151923;border:1px solid #2a2f3a;border-radius:18px;padding:22px;box-shadow:0 10px 40px rgba(0,0,0,.35);text-align:center}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:#22314a;border:1px solid #2f4b7a;font-size:12px;opacity:.95;margin-bottom:10px}
    h1{margin:10px 0 8px;font-size:22px}
    p{margin:0 0 14px;opacity:.9;font-size:14px;line-height:1.35}
    .cta{width:100%;padding:14px;border:0;border-radius:14px;background:#3b82f6;color:#fff;font-weight:800;font-size:16px;cursor:pointer}
    .cta.secondary{margin-top:10px;background:#22c55e}
    .hint{margin-top:12px;font-size:12px;opacity:.75;line-height:1.35;text-align:left;background:#101421;border:1px solid #242b3a;border-radius:12px;padding:10px 12px}
    .hidden{display:none}
  </style>
</head>

<body>
  <div class="card">
    <div class="badge">üì≤ Instala√ß√£o r√°pida</div>
    <h1>Ative o acesso</h1>
    <p>Para continuar, instale o app e abra pelo √≠cone na tela inicial.</p>

    <button class="cta" id="btnInstall">Instalar</button>
    <button class="cta secondary hidden" id="btnOpen">Abrir app</button>

    <div class="hint" id="manualHint">
      Se o bot√£o ‚ÄúInstalar‚Äù n√£o aparecer: –º–µ–Ω—é Chrome (‚ãÆ) ‚Üí <b>Adicionar √† tela inicial</b>.
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const offer = params.get("offer") || "";

    const btnInstall = document.getElementById("btnInstall");
    const btnOpen = document.getElementById("btnOpen");
    const manualHint = document.getElementById("manualHint");

    const appUrl = new URL("../app/", location.href);
    if (offer) appUrl.searchParams.set("offer", offer);

    const isStandalone =
      window.matchMedia("(display-mode: standalone)").matches ||
      window.navigator.standalone === true;

    if (isStandalone) location.href = appUrl.toString();

    let deferredPrompt = null;

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      manualHint.classList.add("hidden");
    });

    btnInstall.addEventListener("click", async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; } catch(_) {}
        deferredPrompt = null;
        btnOpen.classList.remove("hidden");
        return;
      }
      btnOpen.classList.remove("hidden");
    });

    btnOpen.addEventListener("click", () => {
      location.href = appUrl.toString();
    });
  </script>
</body>
</html>

